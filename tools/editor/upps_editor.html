<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPPS Profile Editor 2025.2 - 感情・記憶システム統合モデル対応</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-bright {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .bento-card {
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .bento-card:hover {
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .validation-error {
            color: #FF6B6B;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        } 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .bento-card:hover {
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4F46E5, #06B6D4);
            box-shadow: 0 4px 8px rgba(79, 70, 229, 0.3);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .slider {
            background: linear-gradient(to right, #4F46E5, #06B6D4) 0% / calc(var(--value) * 1%) 100% no-repeat, rgba(255, 255, 255, 0.1);
        }
        
        .emotion-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            background: linear-gradient(45deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2));
            border: 1px solid rgba(79, 172, 254, 0.3);
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        .not-supported {
            background: linear-gradient(45deg, rgba(255, 99, 71, 0.1), rgba(255, 69, 0, 0.1));
            border: 1px solid rgba(255, 99, 71, 0.3);
            color: #FF6347;
        }
        
        .version-badge {
            background: linear-gradient(45deg, #4F46E5, #06B6D4);
            color: white;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    <div x-data="UPPSEditor()" class="container mx-auto px-4 py-8" x-init="init()">
        <!-- Header -->
        <header class="glass rounded-2xl p-6 mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-400 to-cyan-400 flex items-center justify-center">
                        <i data-lucide="brain" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <div class="flex items-center space-x-2">
                            <h1 class="text-2xl font-bold text-white">UPPS Profile Editor</h1>
                            <span class="version-badge">2025.2</span>
                        </div>
                        <p class="text-white/60">Unified Personality Profile Standard</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button @click="toggleTheme()" class="glass rounded-lg p-2 text-white/80 hover:text-white">
                        <i data-lucide="sun" x-show="darkMode" class="w-5 h-5"></i>
                        <i data-lucide="moon" x-show="!darkMode" class="w-5 h-5"></i>
                    </button>
                    <button @click="saveProfile()" class="bg-gradient-to-r from-indigo-500 to-cyan-500 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:from-indigo-600 hover:to-cyan-600 transition">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        <span>保存</span>
                    </button>
                    <button @click="loadFile()" class="glass rounded-lg p-2 text-white/80 hover:text-white">
                        <i data-lucide="upload" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6">
            <!-- Main Editor -->
            <div class="col-span-8">
                <!-- Tabs -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <template x-for="tab in tabs" :key="tab.id">
                        <button 
                            :class="activeTab === tab.id ? 'glass-bright text-white' : 'text-white/60 hover:text-white/80'" 
                            @click="activeTab = tab.id" 
                            class="px-4 py-2 rounded-lg transition flex items-center space-x-2"
                        >
                            <i :data-lucide="tab.icon" class="w-4 h-4"></i>
                            <span x-text="tab.label"></span>
                        </button>
                    </template>
                </div>

                <!-- Tab Content -->
                <div class="bento-card rounded-2xl p-6">
                    <!-- Basic Info Tab -->
                    <div x-show="activeTab === 'basic'" x-transition>
                        <h2 class="text-xl font-semibold text-white mb-6">基本情報</h2>
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label class="block text-white/70 mb-2">名前</label>
                                <input x-model="profile.personal_info.name" class="w-full glass rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="例：山田花子">
                            </div>
                            <div>
                                <label class="block text-white/70 mb-2">年齢</label>
                                <input x-model="profile.personal_info.age" type="number" min="0" max="120" class="w-full glass rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="例：28">
                            </div>
                            <div>
                                <label class="block text-white/70 mb-2">性別</label>
                                <select x-model="profile.personal_info.gender" class="w-full glass rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">
                                    <option value="">選択してください</option>
                                    <option value="Male">男性</option>
                                    <option value="Female">女性</option>
                                    <option value="Other">その他</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-white/70 mb-2">職業</label>
                                <input x-model="profile.personal_info.occupation" class="w-full glass rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="例：医療ソーシャルワーカー">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-white/70 mb-2">背景</label>
                                <textarea x-model="profile.background" rows="4" class="w-full glass rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="幼少期〜現在までの経歴や重要な経験を記入してください。例：幼少期は自然豊かな地域で育ち、読書と科学に没頭していた。現在は都市部で研究職に従事している。"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Current Emotion State Tab -->
                    <div x-show="activeTab === 'current-state'" x-transition>
                        <h2 class="text-xl font-semibold text-white mb-6">現在の感情状態</h2>
                        <div class="mb-6">
                            <div class="glass rounded-lg p-4">
                                <h3 class="text-lg text-white mb-4">感情モニター</h3>
                                <div class="grid grid-cols-3 gap-4">
                                    <template x-for="[emotion, value] in Object.entries(profile.current_emotion_state || {})" :key="emotion">
                                        <div class="bento-card rounded-lg p-3 text-center">
                                            <div class="text-white/60 text-sm mb-1" x-text="getEmotionLabel(emotion)"></div>
                                            <div class="text-xl font-bold text-white" x-text="value + '%'"></div>
                                            <div class="mt-2">
                                                <input type="range" x-model.number="profile.current_emotion_state[emotion]" min="0" max="100" class="slider" :style="'--value: ' + value">
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <button @click="syncEmotionState()" class="mt-4 glass hover:glass-bright rounded-lg px-4 py-2 text-white flex items-center space-x-2">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                <span>感情システムのベースラインから同期</span>
                            </button>
                        </div>
                    </div>

                    <!-- Emotion System Tab -->
                    <div x-show="activeTab === 'emotion'" x-transition>
                        <h2 class="text-xl font-semibold text-white mb-6">感情システム</h2>
                        <div class="mb-6">
                            <label class="block text-white/70 mb-2">感情モデル</label>
                            <select x-model="profile.emotion_system.model" @change="handleEmotionModelChange()" class="w-full glass rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">
                                <option value="Ekman">Ekman（6つの基本感情）</option>
                                <option value="Plutchik">Plutchik（8つの輪モデル）</option>
                                <option value="PAD">PAD（3次元モデル）</option>
                                <option value="Custom">カスタム</option>
                            </select>
                        </div>
                        
                        <div x-show="profile.emotion_system.model !== 'Ekman'" class="bento-card p-6 mb-6 text-center not-supported">
                            <i data-lucide="alert-triangle" class="w-8 h-8 mx-auto mb-2"></i>
                            <h3 class="text-lg font-semibold mb-1">申し訳ありません</h3>
                            <p>このモデルは現在開発中です。Ekmanモデルをご利用ください。</p>
                        </div>
                        
                        <div x-show="profile.emotion_system.model === 'Ekman'" x-transition>
                            <div class="grid grid-cols-2 gap-6">
                                <template x-for="[emotion, data] in Object.entries(profile.emotion_system.emotions || {})" :key="emotion">
                                    <div class="bento-card rounded-xl p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <h3 class="text-white font-medium flex items-center space-x-2">
                                                <i :data-lucide="getEmotionIcon(emotion)" class="w-4 h-4"></i>
                                                <span x-text="getEmotionLabel(emotion)"></span>
                                            </h3>
                                            <span class="emotion-badge" x-text="data.baseline + '%'"></span>
                                        </div>
                                        <div class="mb-4">
                                            <input type="range" x-model.number="data.baseline" min="0" max="100" class="slider" :style="'--value: ' + data.baseline">
                                        </div>
                                        <input x-model="data.description" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400" placeholder="説明を入力">
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Other tabs remain the same as before but with proper structure -->
                    <!-- Personality Tab -->
                    <div x-show="activeTab === 'personality'" x-transition>
                        <h2 class="text-xl font-semibold text-white mb-6">性格特性（Big Five）</h2>
                        <div class="space-y-6">
                            <template x-for="trait in ['openness', 'conscientiousness', 'extraversion', 'agreeableness', 'neuroticism']" :key="trait">
                                <div class="bg-white/5 rounded-lg p-4">
                                    <div class="flex justify-between mb-2">
                                        <label class="text-white/90 font-medium" x-text="getTraitLabel(trait)"></label>
                                        <span class="text-cyan-400 font-semibold" x-text="Math.round(profile.personality.traits[trait] * 100) + '%'"></span>
                                    </div>
                                    <div class="relative">
                                        <input type="range" x-model.number="profile.personality.traits[trait]" min="0" max="1" step="0.01" class="slider" :style="'--value: ' + (profile.personality.traits[trait] * 100)">
                                    </div>
                                    <p class="text-white/50 text-sm mt-1" x-text="getTraitDescription(trait)"></p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Memory System Tab -->
                    <div x-show="activeTab === 'memory'" x-transition>
                        <h2 class="text-xl font-semibold text-white mb-6">記憶システム</h2>
                        <div class="space-y-4">
                            <template x-for="(memory, index) in profile.memory_system.memories" :key="index">
                                <div class="bento-card rounded-xl p-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-white/60 text-sm mb-1">ID</label>
                                            <input x-model="memory.id" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400" placeholder="例：childhood_memory_01">
                                        </div>
                                        <div>
                                            <label class="block text-white/60 text-sm mb-1">タイプ</label>
                                            <select x-model="memory.type" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                <option value="episodic">エピソード記憶</option>
                                                <option value="semantic">意味記憶</option>
                                                <option value="procedural">手続き記憶</option>
                                                <option value="autobiographical">自伝的記憶</option>
                                            </select>
                                        </div>
                                        <div class="col-span-2">
                                            <label class="block text-white/60 text-sm mb-1">内容</label>
                                            <textarea x-model="memory.content" rows="2" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400"></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-white/60 text-sm mb-1">時期</label>
                                            <input x-model="memory.period" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                        </div>
                                        <div class="text-right pt-5">
                                            <button @click="removeMemory(index)" class="text-red-400 hover:text-red-300 transition">
                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <button @click="addMemory()" class="w-full glass hover:glass-bright rounded-lg px-4 py-3 text-white flex items-center justify-center space-x-2 transition">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>記憶を追加</span>
                            </button>
                        </div>
                    </div>

                    <!-- Association System Tab -->
                    <div x-show="activeTab === 'association'" x-transition>
                        <h2 class="text-xl font-semibold text-white mb-6">関連性ネットワーク</h2>
                        
                        <!-- Association List -->
                        <div class="space-y-4 mb-8">
                            <template x-for="(association, index) in profile.association_system?.associations || []" :key="index">
                                <div class="bento-card rounded-xl p-4">
                                    <div class="grid grid-cols-3 gap-4">
                                        <!-- Trigger Section -->
                                        <div>
                                            <h3 class="text-white font-medium mb-2">トリガー</h3>
                                            <div class="space-y-2">
                                                <!-- Trigger Type Selection -->
                                                <select x-model="association.trigger.type" @change="updateAssociationOptions(index)" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                    <option value="memory">記憶</option>
                                                    <option value="emotion">感情</option>
                                                    <option value="external">外部トリガー</option>
                                                    <option value="complex">複合条件</option>
                                                </select>
                                                
                                                <!-- Complex Trigger -->
                                                <template x-if="association.trigger.type === 'complex'">
                                                    <div>
                                                        <select x-model="association.trigger.operator" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                            <option value="AND">AND（すべて満たす）</option>
                                                            <option value="OR">OR（いずれかを満たす）</option>
                                                        </select>
                                                        <button @click="addComplexCondition(index)" class="mt-2 glass hover:glass-bright rounded px-3 py-1 text-white text-sm">
                                                            <i data-lucide="plus" class="w-3 h-3 inline mr-1"></i>条件を追加
                                                        </button>
                                                        
                                                        <template x-for="(condition, conditionIndex) in association.trigger.conditions || []" :key="conditionIndex">
                                                            <div class="mt-2 p-2 bg-white/5 rounded">
                                                                <select x-model="condition.type" @change="updateComplexConditionType(index, conditionIndex)" class="w-full glass rounded px-2 py-1 text-white text-xs mb-1">
                                                                    <option value="memory">記憶</option>
                                                                    <option value="emotion">感情</option>
                                                                    <option value="external">外部</option>
                                                                </select>
                                                                
                                                                <template x-if="condition.type === 'memory'">
                                                                    <select x-model="condition.id" class="w-full glass rounded px-2 py-1 text-white text-xs">
                                                                        <template x-for="memory in profile.memory_system?.memories || []" :key="memory.id">
                                                                            <option :value="memory.id" x-text="memory.id"></option>
                                                                        </template>
                                                                    </select>
                                                                </template>
                                                                
                                                                <template x-if="condition.type === 'emotion'">
                                                                    <div>
                                                                        <select x-model="condition.id" class="w-full glass rounded px-2 py-1 text-white text-xs mb-1">
                                                                            <template x-for="emotion in Object.keys(profile.emotion_system?.emotions || {})" :key="emotion">
                                                                                <option :value="emotion" x-text="getEmotionLabel(emotion)"></option>
                                                                            </template>
                                                                        </select>
                                                                        <input type="number" x-model.number="condition.threshold" placeholder="閾値" min="0" max="100" class="w-full glass rounded px-2 py-1 text-white text-xs">
                                                                    </div>
                                                                </template>
                                                                
                                                                <template x-if="condition.type === 'external'">
                                                                    <div>
                                                                        <select x-model="condition.category" class="w-full glass rounded px-2 py-1 text-white text-xs mb-1">
                                                                            <option value="topics">トピック</option>
                                                                            <option value="environment">環境</option>
                                                                            <option value="keywords">キーワード</option>
                                                                        </select>
                                                                        <input type="text" :value="getExternalConditionItems(index, conditionIndex)" @input="updateExternalConditionItems(index, conditionIndex, $event)" class="w-full glass rounded px-2 py-1 text-white text-xs" placeholder="カンマ区切り">
                                                                    </div>
                                                                </template>
                                                                
                                                                <button @click="removeComplexCondition(index, conditionIndex)" class="mt-1 text-red-400 hover:text-red-300 text-xs">
                                                                    削除
                                                                </button>
                                                            </div>
                                                        </template>
                                                    </div>
                                                </template>
                                                
                                                <!-- Memory Trigger -->
                                                <template x-if="association.trigger.type === 'memory'">
                                                    <select x-model="association.trigger.id" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                        <option value="">記憶を選択</option>
                                                        <template x-for="memory in profile.memory_system?.memories || []" :key="memory.id">
                                                            <option :value="memory.id" x-text="memory.id + ' (' + memory.type + ')'"></option>
                                                        </template>
                                                    </select>
                                                </template>
                                                
                                                <!-- Emotion Trigger -->
                                                <template x-if="association.trigger.type === 'emotion'">
                                                    <div>
                                                        <select x-model="association.trigger.id" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                            <option value="">感情を選択</option>
                                                            <template x-for="emotion in Object.keys(profile.emotion_system?.emotions || {})" :key="emotion">
                                                                <option :value="emotion" x-text="getEmotionLabel(emotion)"></option>
                                                            </template>
                                                        </select>
                                                        <input type="number" x-model.number="association.trigger.threshold" placeholder="閾値 (例：70)" min="0" max="100" class="mt-2 w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                    </div>
                                                </template>
                                                
                                                <!-- External Trigger -->
                                                <template x-if="association.trigger.type === 'external'">
                                                    <div>
                                                        <select x-model="association.trigger.category" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                            <option value="topics">トピック</option>
                                                            <option value="environment">環境</option>
                                                            <option value="keywords">キーワード</option>
                                                        </select>
                                                        <input type="text" x-model="externalItems[index]" @input="updateExternalItems(index)" placeholder="例：花, 草木, 自然" class="mt-2 w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                        
                                        <!-- Response Section -->
                                        <div>
                                            <h3 class="text-white font-medium mb-2">応答</h3>
                                            <div class="space-y-2">
                                                <select x-model="association.response.type" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                    <option value="memory">記憶</option>
                                                    <option value="emotion">感情</option>
                                                </select>
                                                
                                                <!-- Memory Response -->
                                                <template x-if="association.response.type === 'memory'">
                                                    <select x-model="association.response.id" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                        <option value="">記憶を選択</option>
                                                        <template x-for="memory in profile.memory_system?.memories || []" :key="memory.id">
                                                            <option :value="memory.id" x-text="memory.id + ' (' + memory.type + ')'"></option>
                                                        </template>
                                                    </select>
                                                </template>
                                                
                                                <!-- Emotion Response -->
                                                <template x-if="association.response.type === 'emotion'">
                                                    <select x-model="association.response.id" class="w-full glass rounded px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-cyan-400">
                                                        <option value="">感情を選択</option>
                                                        <template x-for="emotion in Object.keys(profile.emotion_system?.emotions || {})" :key="emotion">
                                                            <option :value="emotion" x-text="getEmotionLabel(emotion)"></option>
                                                        </template>
                                                    </select>
                                                </template>
                                                
                                                <div class="flex items-center">
                                                    <span class="text-white/60 text-sm mr-2">関連強度:</span>
                                                    <input type="range" x-model.number="association.response.association_strength" min="0" max="100" class="slider flex-1" :style="'--value: ' + association.response.association_strength">
                                                    <span class="text-white text-sm ml-2" x-text="association.response.association_strength + '%'"></span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Actions -->
                                        <div class="text-right pt-4">
                                            <button @click="removeAssociation(index)" class="text-red-400 hover:text-red-300 transition">
                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <button @click="addAssociation()" class="w-full glass hover:glass-bright rounded-lg px-4 py-3 text-white flex items-center justify-center space-x-2 transition">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>関連性を追加</span>
                            </button>
                        </div>
                        
                        <!-- Visual Editor (Future) -->
                        <div class="bento-card rounded-xl p-6 text-center">
                            <i data-lucide="network" class="w-8 h-8 text-cyan-400 mx-auto mb-2"></i>
                            <h3 class="text-lg text-white mb-1">ビジュアルエディタ</h3>
                            <p class="text-white/50 text-sm mb-4">近日実装予定</p>
                            <button class="glass px-4 py-2 rounded text-white/50 cursor-not-allowed" disabled>開く</button>
                        </div>
                    </div>

                    <!-- Cognitive System Tab -->
                    <div x-show="activeTab === 'cognitive'" x-transition>
                        <h2 class="text-xl font-semibold text-white mb-6">認知能力</h2>
                        <div class="mb-6">
                            <label class="block text-white/70 mb-2">モデル</label>
                            <select x-model="profile.cognitive_system.model" @change="handleCognitiveModelChange()" class="w-full glass rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400">
                                <option value="WAIS-IV">WAIS-IV</option>
                                <option value="CHC">CHC</option>
                                <option value="Custom">カスタム</option>
                            </select>
                        </div>
                        
                        <div x-show="profile.cognitive_system.model !== 'WAIS-IV'" class="bento-card p-6 mb-6 text-center not-supported">
                            <i data-lucide="alert-triangle" class="w-8 h-8 mx-auto mb-2"></i>
                            <h3 class="text-lg font-semibold mb-1">申し訳ありません</h3>
                            <p>このモデルは現在開発中です。WAIS-IVモデルをご利用ください。</p>
                        </div>
                        
                        <div x-show="profile.cognitive_system.model === 'WAIS-IV'" x-transition>
                            <div class="space-y-6">
                                <template x-for="[ability, data] in Object.entries(profile.cognitive_system.abilities || {})" :key="ability">
                                    <div class="bg-white/5 rounded-lg p-4">
                                        <div class="flex justify-between mb-2">
                                            <label class="text-white/90 font-medium" x-text="getAbilityLabel(ability)"></label>
                                            <span class="text-cyan-400 font-semibold" x-text="data.level + '%'"></span>
                                        </div>
                                        <div class="relative">
                                            <input type="range" x-model.number="data.level" min="0" max="100" class="slider" :style="'--value: ' + data.level">
                                        </div>
                                        <p class="text-white/50 text-sm mt-1" x-text="data.description"></p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Panel -->
            <div class="col-span-4">
                <div class="bento-card rounded-2xl p-6 sticky top-8">
                    <h2 class="text-xl font-semibold text-white mb-4">YAML プレビュー</h2>
                    <pre class="bg-black/50 rounded-lg p-4 text-white/80 text-sm overflow-auto max-h-[600px] font-mono" x-text="generateYAML()"></pre>
                    
                    <div class="mt-6 space-y-4">
                        <button @click="exportJSON()" class="w-full glass hover:glass-bright rounded-lg px-4 py-2 text-white flex items-center justify-center space-x-2 transition">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>JSON エクスポート</span>
                        </button>
                        <button @click="exportYAML()" class="w-full glass hover:glass-bright rounded-lg px-4 py-2 text-white flex items-center justify-center space-x-2 transition">
                            <i data-lucide="file-text" class="w-4 h-4"></i>
                            <span>YAML エクスポート</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    function UPPSEditor() {
        return {
            darkMode: true,
            activeTab: 'basic',
            tabs: [
                { id: 'basic', label: '基本情報', icon: 'user' },
                { id: 'personality', label: '性格特性', icon: 'users' },
                { id: 'emotion', label: '感情システム', icon: 'heart' },
                { id: 'current-state', label: '現在の感情', icon: 'activity' },
                { id: 'memory', label: '記憶システム', icon: 'brain-circuit' },
                { id: 'association', label: '関連性', icon: 'network' },
                { id: 'cognitive', label: '認知能力', icon: 'lightbulb' }
            ],
                            profile: {
                personal_info: {
                    name: "Jane Doe",
                    age: 29,
                    gender: "Female",
                    occupation: "Researcher"
                },
                background: "幼少期は自然豊かな地域で育ち、読書と科学に没頭していた。現在は都市部で研究職に従事している。",
                personality: {
                    model: "BigFive",
                    traits: {
                        openness: 0.8,
                        conscientiousness: 0.7,
                        extraversion: 0.4,
                        agreeableness: 0.9,
                        neuroticism: 0.3
                    }
                },
                emotion_system: {
                    model: "Ekman",
                    emotions: {
                        joy: { baseline: 60, description: "幸福感、満足感" },
                        sadness: { baseline: 30, description: "悲しみ、失望感" },
                        anger: { baseline: 25, description: "怒り、いらだち" },
                        fear: { baseline: 40, description: "恐れ、不安" },
                        disgust: { baseline: 20, description: "嫌悪、不快感" },
                        surprise: { baseline: 55, description: "驚き、意外性への反応" }
                    }
                },
                current_emotion_state: {
                    joy: 70,
                    curiosity: 90,
                    nostalgia: 40
                },
                memory_system: {
                    memories: [
                        {
                            id: "childhood_nature",
                            type: "episodic",
                            content: "子供の頃に森で見つけた珍しい昆虫を観察した経験",
                            period: "Childhood (Age 8)"
                        }
                    ]
                },
                association_system: {
                    associations: [
                        {
                            trigger: {
                                type: "memory",
                                id: "childhood_nature"
                            },
                            response: {
                                type: "emotion",
                                id: "joy",
                                association_strength: 80
                            }
                        }
                    ]
                },
                cognitive_system: {
                    model: "WAIS-IV",
                    abilities: {
                        verbal_comprehension: { 
                            level: 85, 
                            description: "言語概念の理解、言語による思考と表現の能力" 
                        },
                        perceptual_reasoning: { 
                            level: 75, 
                            description: "非言語的・視覚的情報の処理と推論能力" 
                        },
                        working_memory: { 
                            level: 80, 
                            description: "情報の一時的保持と操作能力" 
                        },
                        processing_speed: { 
                            level: 70, 
                            description: "単純な視覚情報の迅速な処理能力" 
                        }
                    }
                }
            },
            externalItems: {},
            
            init() {
                lucide.createIcons();
                this.loadProfile();
                this.initExternalItems();
            },
            
            initExternalItems() {
                if (this.profile.association_system?.associations) {
                    this.externalItems = {};
                    this.profile.association_system.associations.forEach((assoc, index) => {
                        if (assoc.trigger.type === 'external' && assoc.trigger.items) {
                            this.externalItems[index] = assoc.trigger.items.join(', ');
                        }
                    });
                }
            },
            
            toggleTheme() {
                this.darkMode = !this.darkMode;
            },
            
            getTraitLabel(trait) {
                const labels = {
                    openness: '開放性',
                    conscientiousness: '誠実性',
                    extraversion: '外向性',
                    agreeableness: '協調性',
                    neuroticism: '神経症的傾向'
                };
                return labels[trait] || trait;
            },
            
            getTraitDescription(trait) {
                const descriptions = {
                    openness: '新しい経験や概念への受容性',
                    conscientiousness: '計画性や責任感',
                    extraversion: '社交性やエネルギーの外向的発散',
                    agreeableness: '他者への思いやりや協力',
                    neuroticism: '感情の不安定さやストレス反応'
                };
                return descriptions[trait] || '';
            },
            
            getEmotionLabel(emotion) {
                const labels = {
                    joy: '喜び',
                    sadness: '悲しみ',
                    anger: '怒り',
                    fear: '恐れ',
                    disgust: '嫌悪',
                    surprise: '驚き',
                    curiosity: '好奇心',
                    nostalgia: '郷愁'
                };
                return labels[emotion] || emotion;
            },
            
            getEmotionIcon(emotion) {
                const icons = {
                    joy: 'smile',
                    sadness: 'frown',
                    anger: 'angry',
                    fear: 'zap',
                    disgust: 'thumbs-down',
                    surprise: